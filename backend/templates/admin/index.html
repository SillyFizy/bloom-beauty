{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .dashboard-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .dashboard-card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }

    .dashboard-card h3 {
        margin-top: 0;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        color: #417690;
    }

    .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
    }

    .stat-item {
        background-color: #f9f9f9;
        border-radius: 4px;
        padding: 10px;
        text-align: center;
    }

    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #417690;
    }

    .stat-label {
        font-size: 12px;
        color: #666;
    }

    .flex-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .half-width {
        flex: 1;
        min-width: 300px;
    }

    .full-width {
        width: 100%;
    }

    .order-status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
    }

    .order-status-item {
        padding: 10px;
        text-align: center;
        border-radius: 4px;
    }

    .bg-pending {
        background-color: #FFF3CD;
    }

    .bg-processing {
        background-color: #CCE5FF;
    }

    .bg-shipped {
        background-color: #D1ECF1;
    }

    .bg-delivered {
        background-color: #D4EDDA;
    }

    .bg-cancelled {
        background-color: #F8D7DA;
    }

    .text-pending {
        color: #856404;
    }

    .text-processing {
        color: #004085;
    }

    .text-shipped {
        color: #0C5460;
    }

    .text-delivered {
        color: #155724;
    }

    .text-cancelled {
        color: #721C24;
    }

    .alert-low-stock {
        background-color: #ffe9e9;
        padding: 10px;
        margin-top: 10px;
        border-radius: 4px;
        color: #d92323;
    }

    .admin-actions {
        margin-bottom: 20px;
    }

    .admin-action-card {
        background-color: #f5f5f5;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .admin-action-card.urgent {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
    }

    .admin-action-title {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .admin-action-description {
        color: #666;
        font-size: 12px;
    }

    .admin-action-button {
        background-color: #417690;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
    }

    .recent-orders-table {
        width: 100%;
        border-collapse: collapse;
    }

    .recent-orders-table th,
    .recent-orders-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .recent-orders-table th {
        background-color: #f5f5f5;
        color: #333;
    }

    .badge {
        display: inline-block;
        padding: 3px 7px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }

    .badge-pending {
        background-color: #FFF3CD;
        color: #856404;
    }

    .badge-processing {
        background-color: #CCE5FF;
        color: #004085;
    }

    .badge-shipped {
        background-color: #D1ECF1;
        color: #0C5460;
    }

    .badge-delivered {
        background-color: #D4EDDA;
        color: #155724;
    }

    .badge-cancelled {
        background-color: #F8D7DA;
        color: #721C24;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>Dashboard Overview</h1>

    {% if admin_actions %}
    <div class="admin-actions">
        <h2>Administrative Actions</h2>
        {% for action in admin_actions %}
        <div class="admin-action-card {% if action.urgent %}urgent{% endif %}">
            <div>
                <div class="admin-action-title">{{ action.name }}</div>
                <div class="admin-action-description">{{ action.description }}</div>
            </div>
            <a href="{{ action.url }}" class="admin-action-button">Go</a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Sales Overview -->
    <div class="dashboard-card">
        <h3>Sales Overview</h3>
        <div class="stat-grid">
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.today.count|default:"0" }}</div>
                <div class="stat-label">Today's Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.today.total_sales|default:"0"|floatformat:2 }}</div>
                <div class="stat-label">Today's Revenue</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.this_week.count|default:"0" }}</div>
                <div class="stat-label">This Week's Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.this_week.total_sales|default:"0"|floatformat:2 }}</div>
                <div class="stat-label">This Week's Revenue</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.this_month.count|default:"0" }}</div>
                <div class="stat-label">This Month's Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ sales_data.this_month.total_sales|default:"0"|floatformat:2 }}</div>
                <div class="stat-label">This Month's Revenue</div>
            </div>
        </div>
    </div>

    <div class="flex-row">
        <!-- Order Status -->
        <div class="dashboard-card half-width">
            <h3>Order Status</h3>
            <div class="order-status-grid">
                <div class="order-status-item bg-pending">
                    <div class="stat-value text-pending">{{ order_status.pending|default:"0" }}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="order-status-item bg-processing">
                    <div class="stat-value text-processing">{{ order_status.processing|default:"0" }}</div>
                    <div class="stat-label">Processing</div>
                </div>
                <div class="order-status-item bg-shipped">
                    <div class="stat-value text-shipped">{{ order_status.shipped|default:"0" }}</div>
                    <div class="stat-label">Shipped</div>
                </div>
                <div class="order-status-item bg-delivered">
                    <div class="stat-value text-delivered">{{ order_status.delivered|default:"0" }}</div>
                    <div class="stat-label">Delivered</div>
                </div>
                <div class="order-status-item bg-cancelled">
                    <div class="stat-value text-cancelled">{{ order_status.cancelled|default:"0" }}</div>
                    <div class="stat-label">Cancelled</div>
                </div>
            </div>
        </div>

        <!-- Payment Status -->
        <div class="dashboard-card half-width">
            <h3>Payment Status</h3>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-value">{{ payment_data.completed|default:"0" }}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ payment_data.pending|default:"0" }}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ payment_data.failed|default:"0" }}</div>
                    <div class="stat-label">Failed</div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-row">
        <!-- Inventory Status -->
        <div class="dashboard-card half-width">
            <h3>Inventory Status</h3>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-value">{{ inventory_data.total|default:"0" }}</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ inventory_data.active|default:"0" }}</div>
                    <div class="stat-label">Active Products</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ inventory_data.low_stock|default:"0" }}</div>
                    <div class="stat-label">Low Stock</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ inventory_data.out_of_stock|default:"0" }}</div>
                    <div class="stat-label">Out of Stock</div>
                </div>
            </div>

            {% if inventory_data.low_stock > 0 %}
            <div class="alert-low-stock">
                ⚠️ {{ inventory_data.low_stock }} products are low in stock and {{ inventory_data.out_of_stock }} are
                out of stock.
            </div>
            {% endif %}
        </div>

        <!-- User Stats -->
        <div class="dashboard-card half-width">
            <h3>User Statistics</h3>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-value">{{ user_data.total|default:"0" }}</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ user_data.new_today|default:"0" }}</div>
                    <div class="stat-label">New Today</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ user_data.new_week|default:"0" }}</div>
                    <div class="stat-label">New This Week</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ user_data.new_month|default:"0" }}</div>
                    <div class="stat-label">New This Month</div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-row">
        <!-- Cart Data -->
        <div class="dashboard-card half-width">
            <h3>Cart Information</h3>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-value">{{ cart_data.active|default:"0" }}</div>
                    <div class="stat-label">Active Carts</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ cart_data.abandoned|default:"0" }}</div>
                    <div class="stat-label">Abandoned Carts</div>
                </div>
            </div>
        </div>

        <!-- Top Products -->
        <div class="dashboard-card half-width">
            <h3>Top Selling Products</h3>
            {% if top_products %}
            <ol>
                {% for product in top_products %}
                <li>{{ product.product__name }} ({{ product.total_sold }} sold)</li>
                {% endfor %}
            </ol>
            {% else %}
            <p>No sales data available yet.</p>
            {% endif %}
        </div>
    </div>

    <h2>Admin Apps</h2>

    {% if app_list %}
    <div class="app-{{ app.app_label }} module{% if app.app_url in request.path|urlencode %} current-app{% endif %}">
        <table>
            {% for app in app_list %}
            <tr
                class="model-{{ model.object_name|lower }}{% if model.admin_url in request.path|urlencode %} current-model{% endif %}">
                <th scope="row"><a href="{{ app.app_url }}">{{ app.name }}</a></th>
                <td>
                    <ul>
                        {% for model in app.models %}
                        <li>
                            {% if model.admin_url %}
                            <a href="{{ model.admin_url }}">{{ model.name }}</a>
                            {% else %}
                            {{ model.name }}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>{% trans "You don't have permission to view or edit anything." %}</p>
    {% endif %}
</div>
{% endblock %}